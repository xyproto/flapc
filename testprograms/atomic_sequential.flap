// Test atomic operations in SEQUENTIAL loop (should work)
println("Testing atomic operations in sequential loop")

ptr := malloc(8)
atomic_store(ptr, 0)

// Use sequential loop @ instead of parallel @@
@ i in 0..<4 {
    old_val := atomic_add(ptr, 1)
}

final_val := atomic_load(ptr)
println(f"Final value: {final_val}")

final_val == 4.0 {
    println("PASSED - sequential loop with atomics works")
}

!final_val == 4.0 {
    println("FAILED")
}
