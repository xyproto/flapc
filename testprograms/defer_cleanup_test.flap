// Test defer with resource cleanup
ptr := malloc(8)
defer free(ptr)

// Verify allocation succeeded (ptr should be non-zero)
ptr != 0 {
    println("Allocation succeeded")
}

atomic_store(ptr, 42)
println(f"Stored: {atomic_load(ptr)}")

// ptr will be freed automatically via defer
println("Done")
