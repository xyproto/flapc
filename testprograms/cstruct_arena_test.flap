// Test cstruct with arena allocation
// NOTE: This test avoids unsafe blocks inside arenas due to a known compiler bug
// that causes binary corruption when combining arena + unsafe + variable access

cstruct Vec3 {
    x as float64
    y as float64
    z as float64
}

printf("Vec3 cstruct:\n")
printf("  size=%.0f\n", Vec3.size)
printf("  x_offset=%.0f\n", Vec3.x.offset)
printf("  y_offset=%.0f\n", Vec3.y.offset)
printf("  z_offset=%.0f\n", Vec3.z.offset)

arena {
    // Allocate memory for a Vec3
    vec_ptr := alloc(Vec3.size)

    printf("Allocated Vec3 at pointer: %.0f\n", vec_ptr)
    printf("âœ“ CStruct metadata + Arena allocation working!\n")
}

printf("Arena deallocated, test complete!\n")
