// Comprehensive defer test

printf("=== Basic Defer Test ===\n")
defer printf("✓ Basic defer works\n")

printf("\n=== LIFO Order Test ===\n")
defer printf("  3rd (executed first)\n")
defer printf("  2nd (executed second)\n")
defer printf("  1st (executed third)\n")

printf("\n=== Resource Cleanup Test ===\n")
ptr := malloc(16)
defer free(ptr)
defer printf("✓ Resource cleanup scheduled\n")

atomic_store(ptr, 123)
val := atomic_load(ptr)
printf("Stored value: %.0f\n", val)

printf("\n=== Program End ===\n")
printf("All defers will execute now in LIFO order:\n")
